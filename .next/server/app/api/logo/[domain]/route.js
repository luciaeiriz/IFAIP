"use strict";(()=>{var o={};o.id=394,o.ids=[394],o.modules={399:o=>{o.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:o=>{o.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},5315:o=>{o.exports=require("path")},1184:(o,e,t)=>{t.r(e),t.d(e,{originalPathname:()=>L,patchFetch:()=>m,requestAsyncStorage:()=>p,routeModule:()=>A,serverHooks:()=>P,staticGenerationAsyncStorage:()=>d});var n={};t.r(n),t.d(n,{GET:()=>u});var s=t(9303),a=t(8716),l=t(3131),r=t(7070);let g=require("fs/promises");var i=t(5315);async function c(){try{let o=(0,i.join)(process.cwd(),"public","cognite_logo.png");return await (0,g.readFile)(o)}catch(o){return console.error("Error reading fallback logo:",o),Buffer.from("iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNk+M9QDwADhgGAWjR9awAAAABJRU5ErkJggg==","base64")}}async function u(o,{params:e}){let t=(await Promise.resolve(e)).domain,n=process.env.LOGO_DEV_API,s=process.env.LOGO_DEV_PUBLIC_API;console.log("[Logo API] ===== REQUEST RECEIVED ====="),console.log(`[Logo API] Domain: ${t}`),console.log(`[Logo API] Secret Key (LOGO_DEV_API) present: ${n?"YES":"NO"}`),console.log(`[Logo API] Secret Key value: ${n?n.substring(0,10)+"...":"NOT SET"}`),console.log(`[Logo API] Public Key (LOGO_DEV_PUBLIC_API) present: ${s?"YES":"NO"}`),console.log(`[Logo API] Public Key value: ${s?s.substring(0,10)+"...":"NOT SET"}`),console.log("[Logo API] All LOGO_DEV env vars:",Object.keys(process.env).filter(o=>o.includes("LOGO_DEV"))),console.log(`[Logo API] Request URL: ${o.url}`);let a=s||n,l=s?"PUBLIC (pk_)":n?"SECRET (sk_)":"NONE";if(!a){console.warn("[Logo API] ⚠️ Logo.dev API key not configured, returning fallback logo"),console.warn("[Logo API] ⚠️ Please set LOGO_DEV_API or LOGO_DEV_PUBLIC_API environment variable in Vercel");let o=new Uint8Array(await c()).buffer;return new r.NextResponse(o,{status:200,headers:{"Content-Type":"image/png","Cache-Control":"public, max-age=3600"}})}if(!t)return console.warn("[Logo API] ⚠️ No domain provided, returning 404"),new r.NextResponse(null,{status:404,headers:{"Cache-Control":"public, max-age=3600"}});try{let o=`https://img.logo.dev/${t}?token=${a}&size=128&format=png&theme=light&fallback=404`;console.log(`[Logo API] Fetching logo for domain: ${t}`),console.log(`[Logo API] Using key type: ${l}`),console.log(`[Logo API] Logo.dev URL: ${o.replace(a,"***")}`);let e=await fetch(o,{signal:AbortSignal.timeout(1e4),headers:{"User-Agent":"IFAIP-Logo-Fetcher/1.0"}});if(console.log(`[Logo API] Response status: ${e.status} for domain: ${t}`),console.log(`[Logo API] Response OK: ${e.ok}`),!e.ok){if(console.log("[Logo API] Checking fallback conditions:"),console.log(`[Logo API]   - Status is 401: ${401===e.status}`),console.log(`[Logo API]   - apiKey exists: ${!!n}`),console.log(`[Logo API]   - publicApiKey exists: ${!!s}`),console.log(`[Logo API]   - keyToUse === apiKey: ${a===n}`),401===e.status&&(s&&a===s&&n||n&&a===n&&s)){let o=a===s?n:s,e=o===s?"PUBLIC (pk_)":"SECRET (sk_)";console.log(`[Logo API] ✅ All conditions met! ${l} returned 401, trying ${e} for domain: ${t}`);let g=`https://img.logo.dev/${t}?token=${o}&size=128&format=png&theme=light&fallback=404`;console.log(`[Logo API] Fallback URL: ${g.replace(o,"***")}`);let i=await fetch(g,{signal:AbortSignal.timeout(1e4),headers:{"User-Agent":"IFAIP-Logo-Fetcher/1.0"}});if(console.log(`[Logo API] Fallback ${e} response status: ${i.status}`),console.log(`[Logo API] Fallback ${e} response OK: ${i.ok}`),i.ok){console.log(`[Logo API] ✅ Fallback ${e} worked! Using ${e} for domain: ${t}`);let o=await i.arrayBuffer(),n=i.headers.get("content-type")||"image/png",s=o.byteLength;return console.log(`[Logo API] ✅ Successfully fetched logo for domain: ${t} (${s} bytes / ${(s/1024).toFixed(2)}KB)`),new r.NextResponse(o,{status:200,headers:{"Content-Type":n,"Cache-Control":"public, max-age=31536000, immutable"}})}console.log(`[Logo API] ❌ Fallback ${e} also failed with status ${i.status}`)}else console.log(`[Logo API] ⚠️ Fallback conditions not met, skipping fallback attempt`);if(401===e.status){console.log(`[Logo API] ⚠️ Authentication failed (401) for domain: ${t}, returning fallback logo`),console.log(`[Logo API] ⚠️ Please check your LOGO_DEV_API or LOGO_DEV_PUBLIC_API key in .env.local`);let o=await c(),e=new Uint8Array(o).buffer;return new r.NextResponse(e,{status:200,headers:{"Content-Type":"image/png","Cache-Control":"public, max-age=3600"}})}return console.log(`[Logo API] Logo.dev returned ${e.status} for domain: ${t}, returning 404`),new r.NextResponse(null,{status:404,headers:{"Cache-Control":"public, max-age=3600"}})}let g=await e.arrayBuffer(),i=e.headers.get("content-type")||"image/png",u=g.byteLength;return console.log(`[Logo API] ✅ Successfully fetched logo for domain: ${t} (${u} bytes / ${(u/1024).toFixed(2)}KB)`),console.log("[Logo API] ===== REQUEST COMPLETE ====="),new r.NextResponse(g,{status:200,headers:{"Content-Type":i,"Cache-Control":"public, max-age=31536000, immutable"}})}catch(o){return console.error(`[Logo API] ❌ Error fetching logo for domain ${t}:`,o),o instanceof Error&&(console.error(`[Logo API] Error message: ${o.message}`),console.error(`[Logo API] Error stack: ${o.stack}`)),new r.NextResponse(null,{status:404,headers:{"Cache-Control":"public, max-age=3600"}})}}let A=new s.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/logo/[domain]/route",pathname:"/api/logo/[domain]",filename:"route",bundlePath:"app/api/logo/[domain]/route"},resolvedPagePath:"/Users/lucia/Documents/GitHub/IFAIP/app/api/logo/[domain]/route.ts",nextConfigOutput:"",userland:n}),{requestAsyncStorage:p,staticGenerationAsyncStorage:d,serverHooks:P}=A,L="/api/logo/[domain]/route";function m(){return(0,l.patchFetch)({serverHooks:P,staticGenerationAsyncStorage:d})}}};var e=require("../../../../webpack-runtime.js");e.C(o);var t=o=>e(e.s=o),n=e.X(0,[276,972],()=>t(1184));module.exports=n})();