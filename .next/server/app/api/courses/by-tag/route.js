"use strict";(()=>{var e={};e.id=368,e.ids=[368],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},1328:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>f,patchFetch:()=>h,requestAsyncStorage:()=>y,routeModule:()=>p,serverHooks:()=>b,staticGenerationAsyncStorage:()=>m});var s={};t.r(s),t.d(s,{GET:()=>d});var n=t(9303),l=t(8716),o=t(3131),i=t(7070),a=t(5662);function u(e){let r=e.type||e.course_type||null;return{id:String(e.id||""),title:String(e.title||""),description:String(e.description||""),headline:e.headline||null,bullet_points:Array.isArray(e.bullet_points)?e.bullet_points:null,provider:e.provider||null,level:e.level||"Beginner",duration:String(e.duration||""),tags:e.tag?[e.tag]:[],external_url:e.external_url||null,priority:Number(e.priority)||999,rating:e.rating?Number(e.rating):null,reviews:e.reviews?Number(e.reviews):null,course_type:r,key_skills:e.key_skills||null,modules:e.modules||null,instructors:e.instructors||null,effort:e.effort||null,languages:e.languages||null,price:e.free_trial||void 0,source:String(e.source||""),signup_enabled:!!(e.signup_enabled??!0),is_featured:!!e.is_featured,price_label:e.price_label||null,free_trial:e.free_trial||null,created_at:e.created_at||null,updated_at:e.updated_at||null}}async function c(e,r={}){try{let{includeHidden:t=!1,limit:s}=r,n="Business"===e?"business_relevancy":"Restaurant"===e?"restaurant_relevancy":"fleet_relevancy";console.log(`ðŸ·ï¸ getCoursesByTagInternal: Fetching courses for tag "${e}" (includeHidden: ${t}, limit: ${s||"none"})...`),console.log(`ðŸ·ï¸ IMPORTANT: NO tag filter, NO signup_enabled filter - getting ALL courses sorted by ${n}`),console.log(`ðŸ·ï¸ Ordering by: ${n} (ascending, nullsFirst: false)`);let l=a.O.from("courses").select("*");l=l.order(n||"priority",{ascending:!0,nullsFirst:!1}),s&&(l=l.limit(s),console.log(`ðŸ·ï¸ Limiting to ${s} courses`));let{data:o,error:i}=await l;if(console.log(`ðŸ·ï¸ Query executed: returned ${o?.length||0} courses (limit was ${s||"none"})`),o&&o.length>0&&console.log(`ðŸ·ï¸ Relevancy scores for returned courses:`,o.map(e=>({id:e.id,title:e.title,[n]:e[n],signup_enabled:e.signup_enabled}))),o&&s&&o.length>s&&console.error(`âŒ ERROR: Query returned ${o.length} courses but limit was ${s}! This should not happen.`),i){console.error("âŒ getCoursesByTagInternal DATABASE ERROR:",i),console.error("Error code:",i.code),console.error("Error message:",i.message),console.warn("âš ï¸ Falling back to priority-based ordering...");let e=a.O.from("courses").select("*");e=e.order("priority",{ascending:!0,nullsFirst:!1}),s&&(e=e.limit(s));let{data:r,error:t}=await e;if(t)return console.error("âŒ Fallback query also failed:",t),[];let n=(r||[]).map(u);return console.log(`ðŸ·ï¸ getCoursesByTagInternal (fallback): Returned ${n.length} courses`),n}if(!o||0===o.length)return console.warn(`âš ï¸ getCoursesByTagInternal: No courses found for tag "${e}"`),[];let c=o.map(u);return s&&c.length>s&&(console.warn(`âš ï¸ WARNING: Database returned ${c.length} courses but limit is ${s}. Truncating to ${s}.`),c=c.slice(0,s)),console.log(`ðŸ·ï¸ getCoursesByTagInternal: Successfully returned ${c.length} courses for tag "${e}" (limit was ${s||"none"})`),c}catch(e){return console.error("âŒ getCoursesByTagInternal EXCEPTION:",e),console.error("Exception message:",e?.message),[]}}async function g(e){return c(e,{includeHidden:!0,limit:10})}async function d(e){try{let r=e.nextUrl.searchParams.get("tag");if(!r||!["Business","Restaurant","Fleet"].includes(r))return i.NextResponse.json({error:"Invalid tag. Must be Business, Restaurant, or Fleet"},{status:400});let t=await g(r);return i.NextResponse.json({tag:r,count:t.length,courses:t})}catch(e){return console.error("Error fetching courses by tag:",e),i.NextResponse.json({error:"Failed to fetch courses"},{status:500})}}let p=new n.AppRouteRouteModule({definition:{kind:l.x.APP_ROUTE,page:"/api/courses/by-tag/route",pathname:"/api/courses/by-tag",filename:"route",bundlePath:"app/api/courses/by-tag/route"},resolvedPagePath:"/Users/lucia/Documents/GitHub/IFAIP/app/api/courses/by-tag/route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:y,staticGenerationAsyncStorage:m,serverHooks:b}=p,f="/api/courses/by-tag/route";function h(){return(0,o.patchFetch)({serverHooks:b,staticGenerationAsyncStorage:m})}},5662:(e,r,t)=>{t.d(r,{O:()=>o});var s=t(7857);let n="https://ktqjebihzkbhsvbqpbui.supabase.co",l="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imt0cWplYmloemtiaHN2YnFwYnVpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjYwNDQwNDksImV4cCI6MjA4MTYyMDA0OX0.VVd6upefHH2g23ijFyx5mv7uJJdt9Xuz9jUkL-Jn-F0";if(!n||!l)throw Error("Missing Supabase environment variables. Please set NEXT_PUBLIC_SUPABASE_URL and NEXT_PUBLIC_SUPABASE_ANON_KEY");let o=(0,s.eI)(n,l,{auth:{persistSession:!0,autoRefreshToken:!0,detectSessionInUrl:!0}})}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[276,972,857],()=>t(1328));module.exports=s})();